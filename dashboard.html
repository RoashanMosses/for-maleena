<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Our Love Space</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav>
        <div class="container">
            <h1>Our Love Space</h1>
            <ul>
                <li><a href="dashboard.html">Home</a></li>
                <li><a href="timeline.html">Timeline</a></li>
                <li><a href="gallery.html">Gallery</a></li>
                <li><a href="memoryjar.html">Memory Jar</a></li>
                <li><a href="letters.html">Letters</a></li>
                <li><a href="goals.html">Goals</a></li>
                <li><a href="visionboard.html">Vision Board</a></li>
                <li><a href="settings.html">Settings</a></li>
                <li><a href="#" id="logout-btn">Logout</a></li>
                <li><button id="dark-mode-toggle" style="background:none; border:none; cursor:pointer; font-size: 1.2rem;">ðŸŒ™</button></li>
            </ul>
        </div>
    </nav>

    <main class="container" style="margin-top: 50px;">
        <div class="card" id="welcome-message">
            <h2 id="welcome-text">Welcome back!</h2>
            <p>Today is a beautiful day to celebrate our love.</p>
        </div>

        <div class="grid">
            <div class="card">
                <h3>Anniversary Countdown</h3>
                <div id="countdown" style="font-size: 2rem; font-weight: bold; color: var(--primary-color);">Loading...</div>
                <p id="countdown-label">Days until our next anniversary</p>
            </div>

            <div class="card">
                <h3>Latest Memory</h3>
                <div id="latest-memory-content" style="font-style: italic;">No memories yet.</div>
                <button class="btn" onclick="window.location.href='memoryjar.html'" style="margin-top: 20px; font-size: 0.9rem; background: var(--secondary-color); color: white;">Add a Memory</button>
            </div>
        </div>

        <div class="card">
            <h3>Quick Links</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <a href="timeline.html" class="btn" style="background: var(--primary-color); color: white;">Add Milestone</a>
                <a href="gallery.html" class="btn" style="background: var(--secondary-color); color: white;">Upload Photo</a>
                <a href="letters.html" class="btn" style="background: var(--primary-color); color: white;">Write Letter</a>
            </div>
        </div>
    </main>

    <div style="position: fixed; bottom: 20px; right: 20px;">
        <button id="music-btn" class="btn" style="border-radius: 50%; width: 50px; height: 50px; padding: 0; display: flex; justify-content: center; align-items: center; box-shadow: var(--shadow);">ðŸŽµ</button>
    </div>

    <audio id="bg-music" loop>
        <source src="https://www.bensound.com/bensound-music/bensound-love.mp3" type="audio/mpeg">
    </audio>

    <script src="js/api.js"></script>
    <script>
        if (!api.getToken()) window.location.href = 'index.html';

        document.getElementById('logout-btn').onclick = () => {
            api.clearToken();
            window.location.href = 'index.html';
        };

        // Dark Mode
        const toggle = document.getElementById('dark-mode-toggle');
        if (localStorage.getItem('dark-mode') === 'enabled') {
            document.body.classList.add('dark-mode');
            toggle.textContent = 'â˜€ï¸';
        }
        toggle.onclick = () => {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('dark-mode', isDark ? 'enabled' : 'disabled');
            toggle.textContent = isDark ? 'â˜€ï¸' : 'ðŸŒ™';
        };

        // Music
        const musicBtn = document.getElementById('music-btn');
        const audio = document.getElementById('bg-music');
        musicBtn.onclick = () => {
            if (audio.paused) {
                audio.play();
                musicBtn.style.background = 'var(--primary-color)';
            } else {
                audio.pause();
                musicBtn.style.background = 'white';
            }
        };

        async function initDashboard() {
            const profile = await api.getProfile();
            const both = await api.getBothUsers();
            
            if (both.length >= 2) {
                document.getElementById('welcome-text').textContent = `Welcome back, ${both[0].name} & ${both[1].name}! â¤`;
            } else {
                document.getElementById('welcome-text').textContent = `Welcome back, ${profile.name}!`;
            }

            // Countdown
            const anniversary = profile.anniversaryDate ? new Date(profile.anniversaryDate) : null;
            if (anniversary) {
                updateCountdown(anniversary);
                setInterval(() => updateCountdown(anniversary), 1000);
            } else {
                document.getElementById('countdown').textContent = 'Set your anniversary date in settings!';
            }

            // Memories
            const memories = await api.getMemories();
            if (memories.length > 0) {
                document.getElementById('latest-memory-content').textContent = memories[memories.length-1].content;
            }
        }

        function updateCountdown(anniversary) {
            const now = new Date();
            let nextAnniversary = new Date(now.getFullYear(), anniversary.getMonth(), anniversary.getDate());
            
            if (now > nextAnniversary) {
                nextAnniversary.setFullYear(now.getFullYear() + 1);
            }

            const diff = nextAnniversary - now;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            document.getElementById('countdown').textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
        }

        initDashboard();
    </script>
</body>
</html>
